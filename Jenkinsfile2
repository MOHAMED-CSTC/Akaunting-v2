pipeline {
    agent any
    tools {
        composer 'Composer' // Assurez-vous que Composer est installé dans Jenkins
    }
    stages {
        stage('SCM') {
            steps {
                // Récupérer le code source depuis le dépôt SCM
                checkout scm
            }
        }

        stage('Install PHP Dependencies') {
            steps {
                // Installer les dépendances PHP avec Composer
                sh 'composer install'
            }
        }

        stage('Snyk Analysis') {
            steps {
                // Analyser le projet avec Snyk
                snykSecurity(
                    snykInstallation: 'Snyk', 
                    snykTokenId: 'Snyk_API',
                    monitorProjectOnBuild: true, 
                    failOnIssues: true,
                    additionalArguments: '--file=composer.json --debug'
                )
            }
        }

        stage('Build') {
            steps {
                echo 'Building...'
                // Ajoutez vos étapes de build ici
            }
        }

        stage('Deploy') {
            steps {
                echo 'Deploying...'
                // Ajoutez vos étapes de déploiement ici
            }
        }
    }
}
